[![Go Report Card](https://goreportcard.com/badge/github.com/ravilushqa/antibruteforce)](https://goreportcard.com/report/github.com/ravilushqa/antibruteforce)

# сервис "Анти-брутфорс"

## Общее описание

Сервис предназначен для борьбы с подбором паролей при авторизации в какой-либо системе.
Сервис вызывается перед авторизацией пользователя и может либо разрешить, либо заблокировать попытку.
Предполагается, что сервис используется только для server-server, т.е. скрыт от конечного пользователя.

## Алгоритм работы

Сервис ограничивает частоту попыток авторизации для различных комбинаций параметров, например:
* не более N = 10 попыток в минуту для данного логина.
* не более M = 100 попыток в минуту для данного пароля (защита от обратного brute-force).
* не более K = 1000 попыток в минуту для данного IP (число большое, т.к. NAT).

White/black листы содержат списки адресов сетей, которые обрабатываются более простым способом.
Если входящий ip в whitelist - сервис безусловно разрешает авторизацию (ok=true), если в blacklist - отклоняет (ok=false).

## Архитектура

Микросервис состоит из API, базы данных для хранения настроек и black/white списков.

## Описание методов API

### Попытка авторизации
Запрос:
* login
* password
* ip

Ответ:
* ok (true/false) - сервис должен возвращать ok=true, если считает что запрос нормальный 
                    и ok=false, если считает что происходит bruteforce.

### Сброс bucket
* login
* ip

Должен очистить bucket-ы соответствующие переданным login и ip

### Добавление IP в blacklist
* subnet (ip + mask)

### Удаление IP из blacklist
* subnet (ip + mask)

### Добавление IP в whitelist
* subnet (ip + mask)

### Удаление IP из whitelist
* subnet (ip + mask)

## Конфигурация
Основные параметры конфигурации: N, M, K - лимиты по достижению которых, сервис считает попытку брутфорсом.

## Command-Line интерфейс
Разработан command-line интерфейс для ручного администрирования сервиса.
Через CLI есть возможность вызвать сброс бакета и управлять whitelist/blacklist-ом.
CLI работает через GRPC интерфейс.

## Развертывание
Перед развертыванием необходимо добавить файл `.config.yaml` в директорию с проектом. Пример файла `.config.yaml.example`  
Развертывание микросервиса осуществляеться командой `make up` в директории с проектом.

## Тестирование
Проект содержит unit тесты реализации leaky-bucket и интеграционные тесты для методов API.  
Развертывание микросервиса осуществляеться командой `make test` в директории с проектом.

## Мониторинг
При запуске сборки в докере поднимается prometheus
Что бы зайти в prometheus нужно пройти по ссылке: http://localhost:9090  
Посмотреть статус: http://localhost:9090/targets
